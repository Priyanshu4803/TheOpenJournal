<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Register</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link rel="stylesheet" href="/css/login2.css" />
    <link rel="icon" type="image/png" href="/images/feather_transparent3.png" />

    <style>
      .otp {
        font-size: 15px;
      }
    </style>
  </head>
  <body>
    <%-include("../partials/navbar.ejs") %>

    <div class="wrapper">
      <form action="/api/v1/users/verify-otp" method="POST">
        <h2>Verify Email</h2>
        <% if (error) { %>
        <small class="error">
          <i class="fas fa-exclamation-circle"></i>
          <%= error %>
        </small>
        <% } %>
        <div class="otp">OTP has been sent to <%= email %></div>
        <div class="input-field">
          <label for="otp">Enter OTP</label>
          <input type="text" name="otp" required />
        </div>
        <!-- Hidden input to include the email -->
        <input type="hidden" name="email" value="<%= email %>" />
        <input type="hidden" name="otp_expires" value="<%= otp_expires %>" />
        <button type="submit">Register</button>
        <!-- Timer to show countdown -->
        <div id="timer" class="otp" style="margin-top: 10px"></div>
      </form>
    </div>
    <h3
      class="otp"
      style="
        margin-top: 15px;
        font-weight: 400;
        margin-left: 10px;
        margin-right: 10px;
      "
    >
      Go back to the previous page if you did not receive the OTP or if the time
      has expired.
    </h3>
    <%-include("../partials/footer.ejs") %>

    <script>
      // Parse otp_expires as a JavaScript date object
      const otpExpires = "<%= otp_expires %>";
      console.log(otpExpires);
      const timerElement = document.getElementById("timer");

      function updateTimer() {
        const now = new Date().getTime();
        const timeRemaining = otpExpires - now;
        const minutes = Math.floor(
          (timeRemaining % (1000 * 60 * 60)) / (1000 * 60)
        );
        const seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);
        timerElement.textContent = `OTP expires in ${minutes}m ${seconds}s`;

        // If time remaining is less than or equal to 0, stop the timer
        if (timeRemaining <= 0) {
          clearInterval(timerInterval);
          timerElement.textContent = "OTP expired";
        }
      }

      // Update timer every second
      const timerInterval = setInterval(updateTimer, 1000);

      // Initially call updateTimer to start the countdown
      updateTimer();
    </script>
  </body>
</html>
